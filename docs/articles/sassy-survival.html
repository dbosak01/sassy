<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Example 7: Survival Analysis â€¢ sassy</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Example 7: Survival Analysis">
<meta property="og:description" content="sassy">
<meta property="og:image" content="https://sassy.r-sassy.org/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">sassy</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.2.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"></ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../articles/sassy.html">Get started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/sassy-listing.html">Example 1: Listing</a>
    </li>
    <li>
      <a href="../articles/sassy-dm.html">Example 2: Demographics Table</a>
    </li>
    <li>
      <a href="../articles/sassy-figure.html">Example 3: Figures</a>
    </li>
    <li>
      <a href="../articles/sassy-ae.html">Example 4: Adverse Events Table</a>
    </li>
    <li>
      <a href="../articles/sassy-vs.html">Example 5: Vital Signs Table</a>
    </li>
    <li>
      <a href="../articles/sassy-figureby.html">Example 6: Figure with By Group</a>
    </li>
    <li>
      <a href="../articles/sassy-survival.html">Example 7: Survival Analysis</a>
    </li>
    <li>
      <a href="../articles/sassy-profile.html">Example 8: Patient Profile</a>
    </li>
    <li>
      <a href="../articles/sassy-forest.html">Example 9: Forest Plot</a>
    </li>
    <li>
      <a href="../articles/sassy-ds.html">Example 10: Disposition Table</a>
    </li>
    <li>
      <a href="../articles/sassy-plisting.html">Example 11: Subject Listing</a>
    </li>
    <li>
      <a href="../articles/sassy-pfigure.html">Example 12: Combined Figure</a>
    </li>
    <li>
      <a href="../articles/sassy-chgbase.html">Example 13: Mean Change From Baseline</a>
    </li>
    <li>
      <a href="../articles/sassy-ae2.html">Example 14: AE Severity in Rows</a>
    </li>
    <li>
      <a href="../articles/sassy-intext.html">Example 15: Intext Table</a>
    </li>
    <li>
      <a href="../articles/sassy-disclaimers.html">Disclaimers</a>
    </li>
    <li>
      <a href="../articles/sassy-faq.html">Frequently Asked Questions</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href=".././articles/sassy-faq.html">FAQ</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li>
  <a href="https://github.com/dbosak01/sassy/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Example 7: Survival Analysis</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dbosak01/sassy/blob/HEAD/vignettes/sassy-survival.Rmd" class="external-link"><code>vignettes/sassy-survival.Rmd</code></a></small>
      <div class="hidden name"><code>sassy-survival.Rmd</code></div>

    </div>

    
    
<p>Below is another complete example showing how <strong>sassy</strong>
functions interact with <strong>tidyverse</strong> to create a survival
analysis. This is the most complicated example in the documentation.</p>
<div class="section level2">
<h2 id="program">Program<a class="anchor" aria-label="anchor" href="#program"></a>
</h2>
<p>There are several interesting aspects to this report. The first is
that the <strong>reporter</strong> package gives you the freedom to
perform any analysis you want. Any statistics that R can produce may be
added to a <strong>reporter</strong> report. You just need to get them
into a data frame or plot, and the <strong>reporter</strong> package
will render the analysis as desired.</p>
<p>Second, observe the ability to append both tabular and plot content
onto the same report. This appending ability was designed into the
<strong>reporter</strong> package from the beginning, and gives you the
flexibility you need to document your entire analysis.</p>
<p>Finally, notice that the table on page one is a complex table, that
is actually composed of two tables stacked on top of one another. The
first table <code>tbl1</code> contains the column headers and some PSGA
counts. The second table <code>tbl2</code> is marked as
<code>headerless</code> and contains the Kaplan-Meier analysis. The two
tables are lined up so they appear as one table. This technique of
stacking one table on top of another allows you to create very complex
tables in a straight-forward manner.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-sassy.org" class="external-link">sassy</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://broom.tidymodels.org/" class="external-link">broom</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rpkgs.datanovia.com/survminer/index.html" class="external-link">survminer</a></span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span><span class="st">"logr.autolog"</span> <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        <span class="st">"logr.notes"</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get temp location for log and report output</span></span>
<span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Open Log</span></span>
<span><span class="va">lf</span> <span class="op">&lt;-</span> <span class="fu">log_open</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tmp</span>, <span class="st">"example7.log"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Load and Filter Data  --------------------------------------------------</span></span>
<span></span>
<span><span class="fu">sep</span><span class="op">(</span><span class="st">"Load and Filter Data"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get path to sample data</span></span>
<span><span class="va">pkg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"sassy"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get adam data</span></span>
<span><span class="fu">libname</span><span class="op">(</span><span class="va">adam</span>, <span class="va">pkg</span>, <span class="st">"sas7bdat"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Filter data</span></span>
<span><span class="va">adsl</span> <span class="op">&lt;-</span> <span class="va">adam</span><span class="op">$</span><span class="va">adsl</span> <span class="op">|&gt;</span>    </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">USUBJID</span>, <span class="va">SEX</span>, <span class="va">AGEGR1</span>, <span class="va">AGE</span>, <span class="va">ARM</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ARM</span> <span class="op">!=</span> <span class="st">"SCREEN FAILURE"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">put</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">adpsga</span> <span class="op">&lt;-</span> <span class="va">adam</span><span class="op">$</span><span class="va">adpsga</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">PARAMCD</span> <span class="op">==</span><span class="st">"PSGA"</span> <span class="op">&amp;</span> <span class="va">TRTA</span> <span class="op">!=</span> <span class="st">""</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">AVISITN</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">USUBJID</span>, <span class="va">TRTA</span>, <span class="va">AVISIT</span>, <span class="va">AVISITN</span>, <span class="va">AVAL</span>, <span class="va">CRIT1FL</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">put</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get population counts</span></span>
<span><span class="va">arm_pop</span> <span class="op">&lt;-</span> <span class="va">adsl</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">ARM</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/enframe.html" class="external-link">deframe</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">put</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Prepare Data ------------------------------------------------------------</span></span>
<span></span>
<span><span class="fu">sep</span><span class="op">(</span><span class="st">"Prepare data for analysis"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Determine minimum visit at which success was achieved"</span><span class="op">)</span></span>
<span><span class="va">adpsga_minvsuccess</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">adpsga</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">CRIT1FL</span> <span class="op">==</span> <span class="st">'Y'</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">USUBJID</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>minvisit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">AVISITN</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Get subjects which did not achieve success"</span><span class="op">)</span></span>
<span><span class="va">adpsga_nosuccess</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html" class="external-link">anti_join</a></span><span class="op">(</span><span class="va">adpsga</span>, <span class="va">adpsga_minvsuccess</span>, by <span class="op">=</span> <span class="op">(</span><span class="st">'USUBJID'</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">USUBJID</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>maxvisit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">AVISITN</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Combine subjects cured with subjects not cured"</span><span class="op">)</span></span>
<span><span class="va">adslpsga_final</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="va">adsl</span>, <span class="va">adpsga</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'USUBJID'</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">adpsga_minvsuccess</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'USUBJID'</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">adpsga_nosuccess</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'USUBJID'</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">(</span><span class="va">AVISITN</span> <span class="op">==</span> <span class="va">minvisit</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">minvisit</span><span class="op">)</span><span class="op">)</span> <span class="op">|</span> </span>
<span>           <span class="op">(</span><span class="va">AVISITN</span> <span class="op">==</span> <span class="va">maxvisit</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">maxvisit</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>cured    <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">CRIT1FL</span> <span class="op">==</span> <span class="st">"Y"</span> <span class="op">~</span> <span class="cn">TRUE</span>,</span>
<span>                              <span class="cn">TRUE</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/logical.html" class="external-link">as.logical</a></span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">minvisit</span>, <span class="op">-</span><span class="va">maxvisit</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Counts  ---------------------------------------------------------------</span></span>
<span></span>
<span><span class="fu">sep</span><span class="op">(</span><span class="st">"Perform Counts and Statistical Tests"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Count patients with PSGA &lt;= 1"</span><span class="op">)</span></span>
<span><span class="va">success_counts</span> <span class="op">&lt;-</span> <span class="va">adslpsga_final</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">cured</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">TRTA</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">TRTA</span>, </span>
<span>              values_from <span class="op">=</span> <span class="va">n</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/transmute.html" class="external-link">transmute</a></span><span class="op">(</span>block <span class="op">=</span> <span class="st">"counts"</span>,</span>
<span>            label <span class="op">=</span> <span class="st">"Number of patients with PSGA &lt;= 1"</span>,</span>
<span>            <span class="st">"ARM A"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">`ARM A`</span><span class="op">)</span>,</span>
<span>            <span class="st">"ARM B"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">`ARM B`</span><span class="op">)</span>,</span>
<span>            <span class="st">"ARM C"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">`ARM C`</span><span class="op">)</span>,</span>
<span>            <span class="st">"ARM D"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">`ARM D`</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>            <span class="fu">put</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Count patients with PSGA &gt; 1"</span><span class="op">)</span></span>
<span><span class="va">failed_counts</span> <span class="op">&lt;-</span> <span class="va">adslpsga_final</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">cured</span> <span class="op">==</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">TRTA</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">TRTA</span>, </span>
<span>              values_from <span class="op">=</span> <span class="va">n</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/transmute.html" class="external-link">transmute</a></span><span class="op">(</span>block <span class="op">=</span> <span class="st">"counts"</span>,</span>
<span>            label <span class="op">=</span> <span class="st">"Number of Censored Subjects (PSGA &gt; 1)"</span>,</span>
<span>            <span class="st">"ARM A"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">`ARM A`</span><span class="op">)</span>,</span>
<span>            <span class="st">"ARM B"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">`ARM B`</span><span class="op">)</span>,</span>
<span>            <span class="st">"ARM C"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">`ARM C`</span><span class="op">)</span>,</span>
<span>            <span class="st">"ARM D"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">`ARM D`</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">put</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">count_block</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">success_counts</span>, <span class="va">failed_counts</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Kaplan-Meier estimates ----------------------------------------------------</span></span>
<span></span>
<span></span>
<span><span class="fu">sep</span><span class="op">(</span><span class="st">"Perform Kaplan-Meier Tests"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Create survival vector"</span><span class="op">)</span></span>
<span><span class="va">surv_vct</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span>time <span class="op">=</span> <span class="va">adslpsga_final</span><span class="op">$</span><span class="va">AVISITN</span>, event <span class="op">=</span> <span class="va">adslpsga_final</span><span class="op">$</span><span class="va">cured</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">put</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Fit model on survival vector"</span><span class="op">)</span></span>
<span><span class="va">stats_survfit_trta</span> <span class="op">&lt;-</span> <span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/survfit.html" class="external-link">survfit</a></span><span class="op">(</span><span class="va">surv_vct</span> <span class="op">~</span> <span class="va">TRTA</span>, data <span class="op">=</span> <span class="va">adslpsga_final</span>, <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">put</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Get model quantiles"</span><span class="op">)</span></span>
<span><span class="va">stats_survfit_quantiles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">stats_survfit_trta</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Get lower confidence intervals"</span><span class="op">)</span></span>
<span><span class="va">ci_lower</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">stats_survfit_quantiles</span><span class="op">$</span><span class="va">lower</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rownames_to_column</a></span><span class="op">(</span><span class="op">)</span>  <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>block <span class="op">=</span> <span class="st">"surv"</span>,</span>
<span>         TRTA <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substring</a></span><span class="op">(</span><span class="va">rowname</span>,<span class="fl">6</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">`25`</span>, <span class="va">`50`</span>, <span class="va">`75`</span><span class="op">)</span>,</span>
<span>               names_to <span class="op">=</span> <span class="st">"Q"</span>,</span>
<span>               values_to <span class="op">=</span> <span class="st">"lower"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">put</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Get upper confidence intervals"</span><span class="op">)</span></span>
<span><span class="va">ci_upper</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">stats_survfit_quantiles</span><span class="op">$</span><span class="va">upper</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rownames_to_column</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>block <span class="op">=</span> <span class="st">"surv"</span>,</span>
<span>         TRTA <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substring</a></span><span class="op">(</span><span class="va">rowname</span>,<span class="fl">6</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">`25`</span>, <span class="va">`50`</span>, <span class="va">`75`</span><span class="op">)</span>,</span>
<span>               names_to <span class="op">=</span> <span class="st">"Q"</span>,</span>
<span>               values_to <span class="op">=</span> <span class="st">"upper"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">put</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Get confidence intervals"</span><span class="op">)</span></span>
<span><span class="va">ci</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="va">ci_lower</span>, <span class="va">ci_upper</span><span class="op">)</span>  <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ci <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"("</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">lower</span><span class="op">)</span>, <span class="st">"-"</span>, <span class="va">lower</span><span class="op">)</span></span>
<span>                     , <span class="st">", "</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">upper</span><span class="op">)</span>, <span class="st">"-"</span>, <span class="va">upper</span><span class="op">)</span>, <span class="st">")"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>id_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"block"</span>, <span class="st">"Q"</span><span class="op">)</span>,</span>
<span>              names_from <span class="op">=</span> <span class="va">TRTA</span>,</span>
<span>              values_from <span class="op">=</span> <span class="va">ci</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>order<span class="op">=</span><span class="fl">2</span>,</span>
<span>         label1   <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">Q</span> <span class="op">==</span> <span class="fl">25</span> <span class="op">~</span> <span class="st">"25th  percentile (weeks)"</span>,</span>
<span>                              <span class="va">Q</span> <span class="op">==</span> <span class="fl">50</span> <span class="op">~</span> <span class="st">"Median (weeks)"</span>,</span>
<span>                              <span class="va">Q</span> <span class="op">==</span> <span class="fl">75</span> <span class="op">~</span> <span class="st">"75th  percentile (weeks)"</span><span class="op">)</span>,</span>
<span>         label2   <span class="op">=</span> <span class="st">"95% Confidence Interval**"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">block</span>, <span class="va">Q</span>, <span class="va">order</span>, <span class="va">label1</span>, <span class="va">label2</span>, </span>
<span>         <span class="va">`ARM A`</span>, <span class="va">`ARM B`</span>, <span class="va">`ARM C`</span>, <span class="va">`ARM D`</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">put</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Get quantiles"</span><span class="op">)</span></span>
<span><span class="va">quants</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">stats_survfit_quantiles</span><span class="op">$</span><span class="va">quantile</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rownames_to_column</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>block <span class="op">=</span> <span class="st">"surv"</span>,</span>
<span>         TRTA <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substring</a></span><span class="op">(</span><span class="va">rowname</span>,<span class="fl">6</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">`25`</span>, <span class="va">`50`</span>, <span class="va">`75`</span><span class="op">)</span>,</span>
<span>               names_to <span class="op">=</span> <span class="st">"Q"</span>,</span>
<span>               values_to <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>id_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"block"</span>, <span class="st">"Q"</span><span class="op">)</span>,</span>
<span>              names_from <span class="op">=</span> <span class="va">TRTA</span>,</span>
<span>              values_from <span class="op">=</span> <span class="va">value</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>order<span class="op">=</span><span class="fl">1</span>,</span>
<span>         label1   <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">Q</span> <span class="op">==</span> <span class="fl">25</span> <span class="op">~</span> <span class="st">"25th  percentile (weeks)"</span>,</span>
<span>                              <span class="va">Q</span> <span class="op">==</span> <span class="fl">50</span> <span class="op">~</span> <span class="st">"Median (weeks)"</span>,</span>
<span>                              <span class="va">Q</span> <span class="op">==</span> <span class="fl">75</span> <span class="op">~</span> <span class="st">"75th  percentile (weeks)"</span><span class="op">)</span>,</span>
<span>         label2   <span class="op">=</span> <span class="st">""</span>,</span>
<span>         `ARM A`  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">`ARM A`</span><span class="op">)</span>,</span>
<span>         `ARM B`  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">`ARM B`</span><span class="op">)</span>,</span>
<span>         `ARM C`  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">`ARM C`</span><span class="op">)</span>,</span>
<span>         `ARM D`  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">`ARM D`</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">block</span>, <span class="va">Q</span>, <span class="va">order</span>, <span class="va">label1</span>, <span class="va">label2</span>, </span>
<span>         <span class="va">`ARM A`</span>, <span class="va">`ARM B`</span>, <span class="va">`ARM C`</span>, <span class="va">`ARM D`</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">put</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Final arrangement"</span><span class="op">)</span></span>
<span><span class="va">kaplan_block</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">quants</span>, <span class="va">ci</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">block</span>, <span class="va">Q</span>, <span class="va">order</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/transmute.html" class="external-link">transmute</a></span><span class="op">(</span><span class="va">block</span>, </span>
<span>            <span class="va">label1</span>, </span>
<span>            label2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">label2</span> <span class="op">==</span> <span class="st">""</span>, <span class="cn">NA</span>, <span class="va">label2</span><span class="op">)</span>,</span>
<span>            <span class="va">`ARM A`</span>, <span class="va">`ARM B`</span>, <span class="va">`ARM C`</span>, <span class="va">`ARM D`</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">put</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Cox Proportional Hazards  -----------------------------------------------</span></span>
<span></span>
<span><span class="fu">sep</span><span class="op">(</span><span class="st">"Perform Cox Proportional Hazards Test"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Run Cox tests"</span><span class="op">)</span></span>
<span><span class="va">stats_surv_cph</span>   <span class="op">&lt;-</span> <span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="va">surv_vct</span> <span class="op">~</span> <span class="va">TRTA</span>, data <span class="op">=</span> <span class="va">adslpsga_final</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">put</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Create summary statistics on Cox results"</span><span class="op">)</span></span>
<span><span class="va">cph_summary</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">stats_surv_cph</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">put</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Extract coefficients"</span><span class="op">)</span></span>
<span><span class="va">cph_coef</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">cph_summary</span><span class="op">$</span><span class="va">coefficients</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rownames_to_column</a></span><span class="op">(</span><span class="op">)</span>  <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>block <span class="op">=</span> <span class="st">"surv"</span>,</span>
<span>         TRTA <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substring</a></span><span class="op">(</span><span class="va">rowname</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">put</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Extract confidence intervals"</span><span class="op">)</span></span>
<span><span class="va">cph_ci</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">cph_summary</span><span class="op">$</span><span class="va">conf.int</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">cph_summary</span><span class="op">$</span><span class="va">conf</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rownames_to_column</a></span><span class="op">(</span><span class="op">)</span>  <span class="op">|&gt;</span> </span>
<span>  <span class="fu">put</span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Create cox statistics block"</span><span class="op">)</span></span>
<span><span class="va">cox_block</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html" class="external-link">bind_cols</a></span><span class="op">(</span><span class="va">cph_coef</span>, <span class="va">cph_ci</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>hazard <span class="op">=</span> <span class="va">`exp(coef)...3`</span>, pval <span class="op">=</span> <span class="va">`Pr(&gt;|z|)`</span>, </span>
<span>         lower <span class="op">=</span> <span class="va">`lower .95`</span>, upper <span class="op">=</span> <span class="va">`upper .95`</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">TRTA</span>, <span class="va">hazard</span>, <span class="va">pval</span>, <span class="va">lower</span>, <span class="va">upper</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>block <span class="op">=</span> <span class="st">"cox"</span>, </span>
<span>         ci <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"("</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">lower</span><span class="op">)</span>, <span class="st">"-"</span>, <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%.2f"</span>, <span class="va">lower</span><span class="op">)</span><span class="op">)</span></span>
<span>                        , <span class="st">", "</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">upper</span><span class="op">)</span>, <span class="st">"-"</span>, <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%.2f"</span>, <span class="va">upper</span><span class="op">)</span><span class="op">)</span>, <span class="st">")"</span><span class="op">)</span>,</span>
<span>         hazard <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%.2f"</span>, <span class="va">hazard</span><span class="op">)</span>,</span>
<span>         pval   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%.3f"</span>, <span class="va">pval</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hazard"</span>, <span class="st">"pval"</span>, <span class="st">"ci"</span><span class="op">)</span>,</span>
<span>               names_to <span class="op">=</span> <span class="st">"stat"</span>,</span>
<span>               values_to <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>id_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"block"</span>, <span class="st">"stat"</span><span class="op">)</span>,</span>
<span>              names_from <span class="op">=</span> <span class="va">TRTA</span>,</span>
<span>              values_from <span class="op">=</span> <span class="va">value</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>label1 <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">stat</span> <span class="op">==</span> <span class="st">"hazard"</span>  </span>
<span>                              <span class="op">~</span> <span class="st">"Hazard Ratio (Each Treatment Group - ARM A)***"</span>,</span>
<span>                            <span class="va">stat</span> <span class="op">==</span> <span class="st">"pval"</span> <span class="op">~</span> <span class="st">"P-value"</span>,</span>
<span>                            <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"95% CI of Hazard Ratio"</span><span class="op">)</span>,</span>
<span>         label2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>,</span>
<span>         `ARM A` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">block</span>, <span class="va">label1</span>, <span class="va">label2</span>, <span class="va">`ARM A`</span>, <span class="va">`ARM B`</span>, <span class="va">`ARM C`</span>, <span class="va">`ARM D`</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">put</span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span></span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Combine statistics blocks"</span><span class="op">)</span></span>
<span><span class="va">stat_block</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">kaplan_block</span>, <span class="va">cox_block</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">put</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create Survival Plot -------------------------------------------------------</span></span>
<span></span>
<span><span class="fu">sep</span><span class="op">(</span><span class="st">"Create survival plot"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Create data frame with zero values for each visit"</span><span class="op">)</span></span>
<span><span class="va">arms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">adslpsga_final</span><span class="op">$</span><span class="va">ARM</span><span class="op">)</span></span>
<span><span class="va">visits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">adslpsga_final</span><span class="op">$</span><span class="va">AVISITN</span><span class="op">)</span></span>
<span><span class="va">all_visits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">arms</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">visits</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">all_visits</span> <span class="op">&lt;-</span> <span class="va">all_visits</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">all_visits</span><span class="op">)</span><span class="op">]</span> </span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Create visit template"</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>ARM <span class="op">=</span> <span class="va">all_visits</span>, </span>
<span>                 AVISIT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Week"</span>, <span class="va">visits</span><span class="op">)</span>, </span>
<span>                 AVISITN <span class="op">=</span> <span class="va">visits</span>,</span>
<span>                 cured <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">put</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Calculate cummulative sum and percent"</span><span class="op">)</span></span>
<span><span class="va">adslpsga_plot</span> <span class="op">&lt;-</span> <span class="va">adslpsga_final</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">ARM</span>, <span class="va">AVISIT</span>, <span class="va">AVISITN</span>, <span class="va">cured</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">ARM</span>, <span class="va">AVISIT</span>, <span class="va">AVISITN</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>sumc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">cured</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">ARM</span>, <span class="va">AVISITN</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">ARM</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>AVISIT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">AVISIT</span> <span class="op">==</span> <span class="st">"Week 0"</span>, <span class="st">"Day 1 Baseline"</span>, <span class="va">AVISIT</span><span class="op">)</span>,</span>
<span>         csumc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">sumc</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>pct <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">ARM</span> <span class="op">==</span> <span class="st">"ARM A"</span> <span class="op">~</span> <span class="va">csumc</span> <span class="op">/</span> <span class="va">arm_pop</span><span class="op">[</span><span class="st">"ARM A"</span><span class="op">]</span>, </span>
<span>                         <span class="va">ARM</span> <span class="op">==</span> <span class="st">"ARM B"</span> <span class="op">~</span> <span class="va">csumc</span> <span class="op">/</span> <span class="va">arm_pop</span><span class="op">[</span><span class="st">"ARM B"</span><span class="op">]</span>,</span>
<span>                         <span class="va">ARM</span> <span class="op">==</span> <span class="st">"ARM C"</span> <span class="op">~</span> <span class="va">csumc</span> <span class="op">/</span> <span class="va">arm_pop</span><span class="op">[</span><span class="st">"ARM C"</span><span class="op">]</span>, </span>
<span>                         <span class="va">ARM</span> <span class="op">==</span> <span class="st">"ARM D"</span> <span class="op">~</span> <span class="va">csumc</span> <span class="op">/</span> <span class="va">arm_pop</span><span class="op">[</span><span class="st">"ARM D"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">put</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add factor to ensure sort order is correct</span></span>
<span><span class="va">adslpsga_plot</span><span class="op">$</span><span class="va">AVISIT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">adslpsga_plot</span><span class="op">$</span><span class="va">AVISIT</span>, </span>
<span>                               levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Day 1 Baseline"</span>, </span>
<span>                                          <span class="st">"Week 2"</span>, </span>
<span>                                          <span class="st">"Week 4"</span>, </span>
<span>                                          <span class="st">"Week 6"</span>, </span>
<span>                                          <span class="st">"Week 8"</span>, </span>
<span>                                          <span class="st">"Week 12"</span>,</span>
<span>                                          <span class="st">"Week 16"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Generate plot"</span><span class="op">)</span></span>
<span><span class="va">surv_gg</span> <span class="op">&lt;-</span> <span class="va">adslpsga_plot</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">pct</span>, x <span class="op">=</span> <span class="va">AVISIT</span> , group <span class="op">=</span> <span class="va">ARM</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="va">ARM</span>, color <span class="op">=</span> <span class="va">ARM</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_step</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>linetype <span class="op">=</span> <span class="va">ARM</span>, color <span class="op">=</span> <span class="va">ARM</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html" class="external-link">scale_x_discrete</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Study Week"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Proportion of Subjects with Initial Success"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span><span class="co"># Print Report ------------------------------------------------------------</span></span>
<span></span>
<span><span class="fu">sep</span><span class="op">(</span><span class="st">"Create and print report"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Create Table 1 with header</span></span>
<span><span class="va">tbl1</span> <span class="op">&lt;-</span> <span class="fu">create_table</span><span class="op">(</span><span class="va">count_block</span>, width <span class="op">=</span> <span class="fl">9</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">column_defaults</span><span class="op">(</span>from <span class="op">=</span> <span class="va">`ARM A`</span>, to <span class="op">=</span> <span class="va">`ARM D`</span>, align <span class="op">=</span> <span class="st">"center"</span>, width <span class="op">=</span> <span class="fl">1.1</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">define</span><span class="op">(</span><span class="va">block</span>, visible <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">define</span><span class="op">(</span><span class="va">label</span>, label <span class="op">=</span> <span class="st">""</span>, width <span class="op">=</span> <span class="fl">4.25</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">define</span><span class="op">(</span><span class="va">`ARM A`</span>,  n <span class="op">=</span> <span class="va">arm_pop</span><span class="op">[</span><span class="st">"ARM A"</span><span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">define</span><span class="op">(</span><span class="va">`ARM B`</span>,  n <span class="op">=</span> <span class="va">arm_pop</span><span class="op">[</span><span class="st">"ARM B"</span><span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">define</span><span class="op">(</span><span class="va">`ARM C`</span>,  n <span class="op">=</span> <span class="va">arm_pop</span><span class="op">[</span><span class="st">"ARM C"</span><span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">define</span><span class="op">(</span><span class="va">`ARM D`</span>,  n <span class="op">=</span> <span class="va">arm_pop</span><span class="op">[</span><span class="st">"ARM D"</span><span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">titles</span><span class="op">(</span><span class="st">"Table 5.0"</span>, bold <span class="op">=</span> <span class="cn">TRUE</span>, blank_row <span class="op">=</span> <span class="st">"above"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">titles</span><span class="op">(</span><span class="st">"Analysis of Time to Initial PSGA Success* in Weeks"</span>, </span>
<span>         <span class="st">"Safety Population"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">label_lookup</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>surv <span class="op">=</span> <span class="st">"Kaplan-Meier estimates"</span>,</span>
<span>                     cox <span class="op">=</span> <span class="st">"Results of Proportional Hazards Regression Analysis"</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co"># Create table 2 for statistics with stub and without header</span></span>
<span><span class="va">tbl2</span> <span class="op">&lt;-</span> <span class="fu">create_table</span><span class="op">(</span><span class="va">stat_block</span>, width <span class="op">=</span> <span class="fl">9</span>, headerless <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">column_defaults</span><span class="op">(</span>from <span class="op">=</span> <span class="va">`ARM A`</span>, to <span class="op">=</span> <span class="va">`ARM D`</span>, align <span class="op">=</span> <span class="st">"center"</span>, width <span class="op">=</span> <span class="fl">1.1</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">stub</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">block</span>, <span class="va">label1</span>, <span class="va">label2</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">4.25</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">define</span><span class="op">(</span><span class="va">block</span>, label_row <span class="op">=</span> <span class="cn">TRUE</span>, format <span class="op">=</span> <span class="va">label_lookup</span>, blank_after <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">define</span><span class="op">(</span><span class="va">label1</span>, indent <span class="op">=</span> <span class="fl">.25</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">define</span><span class="op">(</span><span class="va">label2</span>, indent <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">define</span><span class="op">(</span><span class="va">`ARM A`</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">define</span><span class="op">(</span><span class="va">`ARM B`</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">define</span><span class="op">(</span><span class="va">`ARM C`</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">define</span><span class="op">(</span><span class="va">`ARM D`</span><span class="op">)</span> </span>
<span></span>
<span></span>
<span><span class="co"># Create plot</span></span>
<span><span class="va">plt</span> <span class="op">&lt;-</span> <span class="fu">create_plot</span><span class="op">(</span><span class="va">surv_gg</span>, <span class="fl">3.5</span>, <span class="fl">9</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">titles</span><span class="op">(</span><span class="st">"Figure 5.0"</span>, bold <span class="op">=</span> <span class="cn">TRUE</span>, blank_row <span class="op">=</span> <span class="st">"above"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">titles</span><span class="op">(</span><span class="st">"Kaplan-Meier Plot for Time to Initial PSGA Success (PSGA &lt;= 1)"</span>,</span>
<span>         <span class="st">"Safety Population"</span>, blank_row <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Create Report"</span><span class="op">)</span></span>
<span><span class="co"># Add table 1, table 2, and plot content to the same report.</span></span>
<span><span class="co"># Plot will be on a separate page with it's own title.</span></span>
<span><span class="va">rpt</span> <span class="op">&lt;-</span> <span class="fu">create_report</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tmp</span>, <span class="st">"output/example7.rtf"</span><span class="op">)</span>, output_type <span class="op">=</span> <span class="st">"RTF"</span>, </span>
<span>                     font <span class="op">=</span> <span class="st">"Arial"</span>, missing <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">set_margins</span><span class="op">(</span>top <span class="op">=</span> <span class="fl">1</span>, bottom <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">page_header</span><span class="op">(</span><span class="st">"Sponsor: Client"</span>, <span class="st">"Study: ABC/BBC"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">add_content</span><span class="op">(</span><span class="va">tbl1</span>, page_break <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">add_content</span><span class="op">(</span><span class="va">tbl2</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">add_content</span><span class="op">(</span><span class="va">plt</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">footnotes</span><span class="op">(</span><span class="st">"Program: Surv_Table.R"</span>,</span>
<span>            <span class="st">"* Success: PSGA &lt;= 1: PSGA &gt; 1"</span>,</span>
<span>            <span class="st">"** Based on R survival package survfit() function"</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"*** Based on proportional hazards model with treatment"</span>,</span>
<span>                  <span class="st">"indicator variables as explanatory variables"</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Note: The end-point is cure of the disease (PSGA &lt;= 1)."</span><span class="op">)</span>,</span>
<span>            <span class="st">"  The probability of remaining diseased (PSGA &gt; 1) defines the survival function"</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Note: A subject who is not cured by the end of 12 weeks or is lost"</span>,</span>
<span>            <span class="st">"to follow provides a censored observation for the analysis."</span><span class="op">)</span>,</span>
<span>            <span class="st">"\"-\" = Not Applicable"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">page_footer</span><span class="op">(</span><span class="st">"Date Produced: "</span> <span class="op">%p%</span> <span class="fu">fapply</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"%d%b%y %H:%M"</span><span class="op">)</span>, </span>
<span>              right <span class="op">=</span> <span class="st">"Page [pg] of [tpg]"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Write out the report"</span><span class="op">)</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">write_report</span><span class="op">(</span><span class="va">rpt</span><span class="op">)</span> </span>
<span></span>
<span></span>
<span><span class="co"># Clean Up ----------------------------------------------------------------</span></span>
<span></span>
<span><span class="fu">sep</span><span class="op">(</span><span class="st">"Clean Up"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Close log</span></span>
<span><span class="fu">log_close</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View report</span></span>
<span><span class="co"># file.show(res$file_path)</span></span>
<span></span>
<span><span class="co"># View log</span></span>
<span><span class="co"># file.show(lf)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="output">Output<a class="anchor" aria-label="anchor" href="#output"></a>
</h2>
<p>Here is the report produced by the sample program above:</p>
<p><img src="../man/images/survival1.png"><img src="../man/images/survival2.png"></p>
</div>
<div class="section level2">
<h2 id="log">Log<a class="anchor" aria-label="anchor" href="#log"></a>
</h2>
<p>The above program produces the following log:</p>
<pre><code>=========================================================================
Log Path: C:/Users/dbosa/AppData/Local/Temp/RtmpgrpGQ1/log/example7.log
Program Path: C:\packages\Testing\example7.R
Working Directory: C:/packages/Testing
User Name: dbosa
R Version: 4.1.2 (2021-11-01)
Machine: SOCRATES x86-64
Operating System: Windows 10 x64 build 19041
Base Packages: stats graphics grDevices utils datasets methods base
Other Packages: tidylog_1.0.2 survminer_0.4.9 ggpubr_0.4.0 survival_3.2-13 broom_0.7.10
                reporter_1.2.6 libr_1.2.1 fmtr_1.5.4 logr_1.2.7 sassy_1.0.5
                forcats_0.5.1 stringr_1.4.0 dplyr_1.0.7 purrr_0.3.4 readr_2.0.2
                tidyr_1.1.4 tibble_3.1.5 ggplot2_3.3.5 tidyverse_1.3.1 
Log Start Time: 2021-11-21 15:30:37
=========================================================================

=========================================================================
Load and Filter Data
=========================================================================

# library 'adam': 2 items
- attributes: sas7bdat not loaded
- path: C:/Users/dbosa/Documents/R/win-library/4.1/reporter/extdata
- items:
    Name Extension Rows Cols     Size
1 adpsga  sas7bdat 1206   42 424.8 Kb
2   adsl  sas7bdat  152   56  98.7 Kb
         LastModified
1 2021-10-09 13:57:48
2 2021-10-09 13:57:48

select: dropped 51 variables (STUDYID, SUBJID, SITEID, AGEU, RACE, &lt;U+0085&gt;)

filter: removed 2 rows (1%), 150 rows remaining

# A tibble: 150 x 5
   USUBJID    SEX   AGEGR1        AGE ARM  
   &lt;chr&gt;      &lt;chr&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;
 1 ABC-01-049 M     30-39 years    39 ARM D
 2 ABC-01-050 M     40-49 years    47 ARM B
 3 ABC-01-051 M     30-39 years    34 ARM A
 4 ABC-01-052 F     40-49 years    45 ARM C
 5 ABC-01-053 F     18-29 years    26 ARM B
 6 ABC-01-054 M     40-49 years    44 ARM D
 7 ABC-01-055 F     40-49 years    47 ARM C
 8 ABC-01-056 M     30-39 years    31 ARM A
 9 ABC-01-113 M     &gt;65 years      74 ARM D
10 ABC-01-114 F     &gt;65 years      72 ARM B
# ... with 140 more rows

filter: removed 256 rows (21%), 950 rows remaining

select: dropped 36 variables (STUDYID, SUBJID, SITEID, QSSEQ, TRTP, &lt;U+0085&gt;)

# A tibble: 950 x 6
   USUBJID    TRTA  AVISIT     AVISITN  AVAL
   &lt;chr&gt;      &lt;chr&gt; &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt;
 1 ABC-01-049 ARM D Day 1 Bas~       0     3
 2 ABC-01-049 ARM D Week 2           2     2
 3 ABC-01-049 ARM D Week 4           4     3
 4 ABC-01-049 ARM D Week 6           6     3
 5 ABC-01-049 ARM D Week 8           8     2
 6 ABC-01-049 ARM D Week 8           8     2
 7 ABC-01-049 ARM D Week 12         12     2
 8 ABC-01-049 ARM D Week 16         16     3
 9 ABC-01-050 ARM B Day 1 Bas~       0     3
10 ABC-01-050 ARM B Week 2           2     3
# ... with 940 more rows, and 1 more
#   variable: CRIT1FL &lt;chr&gt;

count: now 4 rows and 2 columns, ungrouped

ARM A ARM B ARM C ARM D 
   36    38    38    38 

=========================================================================
Prepare data for analysis
=========================================================================

Determine minimum visit at which success was achieved

filter: removed 833 rows (88%), 117 rows remaining

group_by: one grouping variable (USUBJID)

summarize: now 43 rows and 2 columns, ungrouped

Get subjects which did not achieve success

anti_join: added no columns

           &gt; rows only in x   659

           &gt; rows only in y  (  0)

           &gt; matched rows    (291)

           &gt;                 =====

           &gt; rows total       659

group_by: one grouping variable (USUBJID)

summarize: now 102 rows and 2 columns, ungrouped

Combine subjects cured with subjects not cured

inner_join: added 5 columns (TRTA, AVISIT, AVISITN, AVAL, CRIT1FL)

            &gt; rows only in x  (  5)

            &gt; rows only in y  (  0)

            &gt; matched rows     950    (includes duplicates)

            &gt;                 =====

            &gt; rows total       950

left_join: added one column (minvisit)

           &gt; rows only in x   659

           &gt; rows only in y  (  0)

           &gt; matched rows     291

           &gt;                 =====

           &gt; rows total       950

left_join: added one column (maxvisit)

           &gt; rows only in x   291

           &gt; rows only in y  (  0)

           &gt; matched rows     659

           &gt;                 =====

           &gt; rows total       950

filter: removed 803 rows (85%), 147 rows remaining

mutate: new variable 'cured' (logical) with 2 unique values and 0% NA

select: dropped 2 variables (minvisit, maxvisit)

=========================================================================
Perform Counts and Statistical Tests
=========================================================================

Count patients with PSGA &lt;= 1

filter: removed 104 rows (71%), 43 rows remaining

count: now 4 rows and 2 columns, ungrouped

pivot_wider: reorganized (TRTA, n) into (ARM A, ARM B, ARM C, ARM D) [was 4x2, now 1x4]

transmute: new variable 'block' (character) with one unique value and 0% NA

           new variable 'label' (character) with one unique value and 0% NA

           converted 'ARM A' from integer to character (0 new NA)

           converted 'ARM B' from integer to character (0 new NA)

           converted 'ARM C' from integer to character (0 new NA)

           converted 'ARM D' from integer to character (0 new NA)

# A tibble: 1 x 6
  block  label       `ARM A` `ARM B` `ARM C`
  &lt;chr&gt;  &lt;chr&gt;       &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  
1 counts Number of ~ 5       11      16     
# ... with 1 more variable: ARM D &lt;chr&gt;

Count patients with PSGA &gt; 1

filter: removed 43 rows (29%), 104 rows remaining

count: now 4 rows and 2 columns, ungrouped

pivot_wider: reorganized (TRTA, n) into (ARM A, ARM B, ARM C, ARM D) [was 4x2, now 1x4]

transmute: new variable 'block' (character) with one unique value and 0% NA

           new variable 'label' (character) with one unique value and 0% NA

           converted 'ARM A' from integer to character (0 new NA)

           converted 'ARM B' from integer to character (0 new NA)

           converted 'ARM C' from integer to character (0 new NA)

           converted 'ARM D' from integer to character (0 new NA)

# A tibble: 1 x 6
  block  label       `ARM A` `ARM B` `ARM C`
  &lt;chr&gt;  &lt;chr&gt;       &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  
1 counts Number of ~ 31      26      21     
# ... with 1 more variable: ARM D &lt;chr&gt;

=========================================================================
Perform Kaplan-Meier Tests
=========================================================================

Create survival vector

  [1] 16+ 12+ 12+  4  12+ 12+ 12+  6  16+
 [10]  4  16+ 16+ 16+ 16+ 16+  2  16+ 16+
 [19] 16+ 16+ 16+  8  16  16+ 16+ 16+ 16+
 [28] 16+ 16+ 16+ 16+ 16+ 16+  2  16+ 16+
 [37]  8  16+ 16+ 16+ 16+ 16+ 16+ 16+ 16+
 [46] 16+ 12  16+ 16+ 16+ 12+  4  16+ 16+
 [55] 12+  2  12   4  16+  6   6   6  12 
 [64] 16+ 16+ 16  12+ 12+  8+ 12+ 12+  6+
 [73] 12  12  16+ 16+  0+  6  16+ 16+ 16+
 [82] 16  16+ 12+ 12+  4  16   6   4   6 
 [91] 16+ 16+  6   6+ 16+  8  16+ 16+ 16+
[100] 16+ 16+ 16+  6   4+ 16+ 12+  6  16+
[109]  8   2  12+  8  16+ 16+ 16   6  16+
[118] 12+  2+ 16+  4  16+ 16+ 12+ 16+ 16+
[127] 16+ 12  16  16+ 16+ 12+  6  16+ 16+
[136]  2   4  16+ 16+ 16+ 16+ 12+ 12+ 16+
[145] 16+ 16+  6 

Fit model on survival vector

Call: survfit(formula = surv_vct ~ TRTA, data = adslpsga_final)

            n events median 0.95LCL 0.95UCL
TRTA=ARM A 36      5     NA      NA      NA
TRTA=ARM B 37     11     NA      NA      NA
TRTA=ARM C 37     16     NA      16      NA
TRTA=ARM D 37     11     NA      NA      NA

Get model quantiles

Get lower confidence intervals

mutate: new variable 'block' (character) with one unique value and 0% NA

        new variable 'TRTA' (character) with 4 unique values and 0% NA

pivot_longer: reorganized (25, 50, 75) into (Q, lower) [was 4x6, now 12x5]

# A tibble: 12 x 5
   rowname    block TRTA  Q     lower
   &lt;chr&gt;      &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt;
 1 TRTA=ARM A surv  ARM A 25       NA
 2 TRTA=ARM A surv  ARM A 50       NA
 3 TRTA=ARM A surv  ARM A 75       NA
 4 TRTA=ARM B surv  ARM B 25        6
 5 TRTA=ARM B surv  ARM B 50       NA
 6 TRTA=ARM B surv  ARM B 75       NA
 7 TRTA=ARM C surv  ARM C 25        6
 8 TRTA=ARM C surv  ARM C 50       16
 9 TRTA=ARM C surv  ARM C 75       NA
10 TRTA=ARM D surv  ARM D 25        6
11 TRTA=ARM D surv  ARM D 50       NA
12 TRTA=ARM D surv  ARM D 75       NA

Get upper confidence intervals

mutate: new variable 'block' (character) with one unique value and 0% NA

        new variable 'TRTA' (character) with 4 unique values and 0% NA

pivot_longer: reorganized (25, 50, 75) into (Q, upper) [was 4x6, now 12x5]

# A tibble: 12 x 5
   rowname    block TRTA  Q     upper
   &lt;chr&gt;      &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt;
 1 TRTA=ARM A surv  ARM A 25       NA
 2 TRTA=ARM A surv  ARM A 50       NA
 3 TRTA=ARM A surv  ARM A 75       NA
 4 TRTA=ARM B surv  ARM B 25       NA
 5 TRTA=ARM B surv  ARM B 50       NA
 6 TRTA=ARM B surv  ARM B 75       NA
 7 TRTA=ARM C surv  ARM C 25       16
 8 TRTA=ARM C surv  ARM C 50       NA
 9 TRTA=ARM C surv  ARM C 75       NA
10 TRTA=ARM D surv  ARM D 25       NA
11 TRTA=ARM D surv  ARM D 50       NA
12 TRTA=ARM D surv  ARM D 75       NA

Get confidence intervals

inner_join: added one column (upper)

            &gt; rows only in x  ( 0)

            &gt; rows only in y  ( 0)

            &gt; matched rows     12

            &gt;                 ====

            &gt; rows total       12

mutate: new variable 'ci' (character) with 4 unique values and 0% NA

pivot_wider: reorganized (rowname, TRTA, lower, upper, ci) into (ARM A, ARM B, ARM C, ARM D) [was 12x7, now 3x6]

mutate: new variable 'order' (double) with one unique value and 0% NA

        new variable 'label1' (character) with 3 unique values and 0% NA

        new variable 'label2' (character) with one unique value and 0% NA

select: columns reordered (block, Q, order, label1, label2, &lt;U+0085&gt;)

# A tibble: 3 x 9
  block Q     order label1   label2  `ARM A`
  &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;  
1 surv  25        2 25th  p~ 95% Co~ (-, -) 
2 surv  50        2 Median ~ 95% Co~ (-, -) 
3 surv  75        2 75th  p~ 95% Co~ (-, -) 
# ... with 3 more variables: ARM B &lt;chr&gt;,
#   ARM C &lt;chr&gt;, ARM D &lt;chr&gt;

Get quantiles

mutate: new variable 'block' (character) with one unique value and 0% NA

        new variable 'TRTA' (character) with 4 unique values and 0% NA

pivot_longer: reorganized (25, 50, 75) into (Q, value) [was 4x6, now 12x5]

pivot_wider: reorganized (rowname, TRTA, value) into (ARM A, ARM B, ARM C, ARM D) [was 12x5, now 3x6]

mutate: converted 'ARM A' from double to character (0 new NA)

        converted 'ARM B' from double to character (0 new NA)

        converted 'ARM C' from double to character (0 new NA)

        converted 'ARM D' from double to character (0 new NA)

        new variable 'order' (double) with one unique value and 0% NA

        new variable 'label1' (character) with 3 unique values and 0% NA

        new variable 'label2' (character) with one unique value and 0% NA

select: columns reordered (block, Q, order, label1, label2, &lt;U+0085&gt;)

# A tibble: 3 x 9
  block Q     order label1    label2 `ARM A`
  &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;  &lt;chr&gt;  
1 surv  25        1 25th  pe~ ""     &lt;NA&gt;   
2 surv  50        1 Median (~ ""     &lt;NA&gt;   
3 surv  75        1 75th  pe~ ""     &lt;NA&gt;   
# ... with 3 more variables: ARM B &lt;chr&gt;,
#   ARM C &lt;chr&gt;, ARM D &lt;chr&gt;

Final arrangement

transmute: dropped 2 variables (Q, order)

           changed 3 values (50%) of 'label2' (3 new NA)

# A tibble: 6 x 7
  block label1     label2    `ARM A` `ARM B`
  &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt;  
1 surv  25th  per~ &lt;NA&gt;      &lt;NA&gt;    12     
2 surv  25th  per~ 95% Conf~ (-, -)  (6, -) 
3 surv  Median (w~ &lt;NA&gt;      &lt;NA&gt;    &lt;NA&gt;   
4 surv  Median (w~ 95% Conf~ (-, -)  (-, -) 
5 surv  75th  per~ &lt;NA&gt;      &lt;NA&gt;    &lt;NA&gt;   
6 surv  75th  per~ 95% Conf~ (-, -)  (-, -) 
# ... with 2 more variables: ARM C &lt;chr&gt;,
#   ARM D &lt;chr&gt;

=========================================================================
Perform Cox Proportional Hazards Test
=========================================================================

Run Cox tests

Call:
survival::coxph(formula = surv_vct ~ TRTA, data = adslpsga_final)

            coef exp(coef) se(coef)     z
TRTAARM B 0.9185    2.5055   0.5395 1.703
TRTAARM C 1.3111    3.7102   0.5127 2.557
TRTAARM D 0.8648    2.3744   0.5394 1.603
               p
TRTAARM B 0.0886
TRTAARM C 0.0105
TRTAARM D 0.1089

Likelihood ratio test=7.87  on 3 df, p=0.04877
n= 147, number of events= 43 

Create summary statistics on Cox results

Call:
survival::coxph(formula = surv_vct ~ TRTA, data = adslpsga_final)

  n= 147, number of events= 43 

            coef exp(coef) se(coef)     z
TRTAARM B 0.9185    2.5055   0.5395 1.703
TRTAARM C 1.3111    3.7102   0.5127 2.557
TRTAARM D 0.8648    2.3744   0.5394 1.603
          Pr(&gt;|z|)  
TRTAARM B   0.0886 .
TRTAARM C   0.0105 *
TRTAARM D   0.1089  
---
Signif. codes:    0 &lt;U+0091&gt;***&lt;U+0092&gt; 0.001 &lt;U+0091&gt;**&lt;U+0092&gt; 0.01 &lt;U+0091&gt;*&lt;U+0092&gt; 0.05 &lt;U+0091&gt;.&lt;U+0092&gt;
  0.1 &lt;U+0091&gt; &lt;U+0092&gt; 1

          exp(coef) exp(-coef) lower .95
TRTAARM B     2.505     0.3991    0.8704
TRTAARM C     3.710     0.2695    1.3584
TRTAARM D     2.374     0.4212    0.8249
          upper .95
TRTAARM B     7.212
TRTAARM C    10.134
TRTAARM D     6.834

Concordance= 0.61  (se = 0.042 )
Likelihood ratio test= 7.87  on 3 df,   p=0.05
Wald test            = 6.68  on 3 df,   p=0.08
Score (logrank) test = 7.32  on 3 df,   p=0.06


Extract coefficients

mutate: new variable 'block' (character) with one unique value and 0% NA

        new variable 'TRTA' (character) with 3 unique values and 0% NA

    rowname      coef exp(coef)  se(coef)
1 TRTAARM B 0.9184774  2.505473 0.5394543
2 TRTAARM C 1.3110748  3.710159 0.5126631
3 TRTAARM D 0.8647564  2.374428 0.5394037
         z   Pr(&gt;|z|) block  TRTA
1 1.702605 0.08864206  surv ARM B
2 2.557381 0.01054637  surv ARM C
3 1.603171 0.10889687  surv ARM D

Extract confidence intervals

  rowname exp(coef) exp(-coef) lower .95
1       1  2.505473  0.3991263 0.8703729
2       2  3.710159  0.2695302 1.3583539
3       3  2.374428  0.4211541 0.8249311
  upper .95
1  7.212304
2 10.133796
3  6.834396

Create cox statistics block

rename: renamed 4 variables (hazard, pval, lower, upper)

select: dropped 8 variables (rowname...1, coef, se(coef), z, block, &lt;U+0085&gt;)

mutate: converted 'hazard' from double to character (0 new NA)

        converted 'pval' from double to character (0 new NA)

        new variable 'block' (character) with one unique value and 0% NA

        new variable 'ci' (character) with 3 unique values and 0% NA

pivot_longer: reorganized (hazard, pval, ci) into (stat, value) [was 3x7, now 9x6]

pivot_wider: reorganized (TRTA, lower, upper, value) into (ARM B, ARM C, ARM D) [was 9x6, now 3x5]

mutate: new variable 'label1' (character) with 3 unique values and 0% NA

        new variable 'label2' (character) with one unique value and 100% NA

        new variable 'ARM A' (character) with one unique value and 100% NA

select: dropped one variable (stat)

# A tibble: 3 x 7
  block label1        label2 `ARM A` `ARM B`
  &lt;chr&gt; &lt;chr&gt;         &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt;  
1 cox   Hazard Ratio~ &lt;NA&gt;   &lt;NA&gt;    2.51   
2 cox   P-value       &lt;NA&gt;   &lt;NA&gt;    0.089  
3 cox   95% CI of Ha~ &lt;NA&gt;   &lt;NA&gt;    (0.87,~
# ... with 2 more variables: ARM C &lt;chr&gt;,
#   ARM D &lt;chr&gt;

Combine statistics blocks

# A tibble: 9 x 7
  block label1      label2   `ARM A` `ARM B`
  &lt;chr&gt; &lt;chr&gt;       &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;  
1 surv  25th  perc~ &lt;NA&gt;     &lt;NA&gt;    12     
2 surv  25th  perc~ 95% Con~ (-, -)  (6, -) 
3 surv  Median (we~ &lt;NA&gt;     &lt;NA&gt;    &lt;NA&gt;   
4 surv  Median (we~ 95% Con~ (-, -)  (-, -) 
5 surv  75th  perc~ &lt;NA&gt;     &lt;NA&gt;    &lt;NA&gt;   
6 surv  75th  perc~ 95% Con~ (-, -)  (-, -) 
7 cox   Hazard Rat~ &lt;NA&gt;     &lt;NA&gt;    2.51   
8 cox   P-value     &lt;NA&gt;     &lt;NA&gt;    0.089  
9 cox   95% CI of ~ &lt;NA&gt;     &lt;NA&gt;    (0.87,~
# ... with 2 more variables: ARM C &lt;chr&gt;,
#   ARM D &lt;chr&gt;

=========================================================================
Create survival plot
=========================================================================

Create data frame with zero values for each visit

Create visit template

     ARM  AVISIT AVISITN cured
1  ARM A Week 16      16 FALSE
2  ARM A Week 12      12 FALSE
3  ARM A  Week 4       4 FALSE
4  ARM A  Week 6       6 FALSE
5  ARM A  Week 2       2 FALSE
6  ARM A  Week 8       8 FALSE
7  ARM A  Week 0       0 FALSE
8  ARM B Week 16      16 FALSE
9  ARM B Week 12      12 FALSE
10 ARM B  Week 4       4 FALSE
11 ARM B  Week 6       6 FALSE
12 ARM B  Week 2       2 FALSE
13 ARM B  Week 8       8 FALSE
14 ARM B  Week 0       0 FALSE
15 ARM C Week 16      16 FALSE
16 ARM C Week 12      12 FALSE
17 ARM C  Week 4       4 FALSE
18 ARM C  Week 6       6 FALSE
19 ARM C  Week 2       2 FALSE
20 ARM C  Week 8       8 FALSE
21 ARM C  Week 0       0 FALSE
22 ARM D Week 16      16 FALSE
23 ARM D Week 12      12 FALSE
24 ARM D  Week 4       4 FALSE
25 ARM D  Week 6       6 FALSE
26 ARM D  Week 2       2 FALSE
27 ARM D  Week 8       8 FALSE
28 ARM D  Week 0       0 FALSE

Calculate cummulative sum and percent

select: dropped 7 variables (USUBJID, SEX, AGEGR1, AGE, TRTA, &lt;U+0085&gt;)

group_by: 3 grouping variables (ARM, AVISIT, AVISITN)

summarize: now 29 rows and 4 columns, 2 group variables remaining (ARM, AVISIT)

group_by: one grouping variable (ARM)

mutate (grouped): changed 4 values (14%) of 'AVISIT' (0 new NA)

                  new variable 'csumc' (integer) with 13 unique values and 0% NA

distinct (grouped): removed one row (3%), 28 rows remaining

mutate (grouped): new variable 'pct' (double) with 16 unique values and 0% NA

# A tibble: 28 x 6
# Groups:   ARM [4]
   ARM   AVISIT   AVISITN  sumc csumc    pct
   &lt;chr&gt; &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt; &lt;int&gt;  &lt;dbl&gt;
 1 ARM A Day 1 B~       0     0     0 0     
 2 ARM A Week 2         2     0     0 0     
 3 ARM A Week 4         4     1     1 0.0278
 4 ARM A Week 6         6     3     4 0.111 
 5 ARM A Week 8         8     1     5 0.139 
 6 ARM A Week 12       12     0     5 0.139 
 7 ARM A Week 16       16     0     5 0.139 
 8 ARM B Day 1 B~       0     0     0 0     
 9 ARM B Week 2         2     1     1 0.0263
10 ARM B Week 4         4     4     5 0.132 
# ... with 18 more rows

Generate plot

=========================================================================
Create and print report
=========================================================================

Create Report

Write out the report

# A report specification: 2 pages
- file_path: 'output/example5.rtf'
- output_type: RTF
- units: inches
- orientation: landscape
- margins: top 1 bottom 1 left 1 right 1
- line size/count: 9/40
- page_header: left=Sponsor: Client right=Study: ABC/BBC
- footnote 1: 'Program: Surv_Table.R'
- footnote 2: '* Success: PSGA &lt;= 1: PSGA &gt; 1'
- footnote 3: '** Based on R survival package survfit() function'
- footnote 4: '*** Based on proportional hazards model with treatment indicator variables as explanatory variables'
- footnote 5: 'Note: The end-point is cure of the disease (PSGA &lt;= 1).'
- footnote 6: '  The probability of remaining diseased (PSGA &gt; 1) defines the survival function'
- footnote 7: 'Note: A subject who is not cured by the end of 12 weeks or is lost to follow provides a censored observation for the analysis.'
- footnote 8: '"-" = Not Applicable'
- page_footer: left=Date Produced: 21Nov21 15:30 center= right=Page [pg] of [tpg]
- content: 
# A table specification:
- data: tibble 'count_block' 2 rows 6 cols
- show_cols: all
- use_attributes: all
- width: 9
- title 1: 'Table 5.0'
- title 2: 'Analysis of Time to Initial PSGA Success* in Weeks'
- title 3: 'Safety Population'
- define: block visible='FALSE' 
- define: label '' width=4.25 
- define: ARM A 
- define: ARM B 
- define: ARM C 
- define: ARM D 
# A table specification:
- data: tibble 'stat_block' 9 rows 7 cols
- show_cols: all
- use_attributes: all
- width: 9
- headerless: TRUE
- stub: block label1 label2 width=4.25 align='left' 
- define: block dedupe='TRUE' 
- define: label1 
- define: label2 
- define: ARM A 
- define: ARM B 
- define: ARM C 
- define: ARM D 
# A plot specification: 
- data: 28 rows, 7 cols
- layers: 2
- height: 3.5
- width: 9
- title 1: 'Figure 5.0'
- title 2: 'Kaplan-Meier Plot for Time to Initial PSGA Success (PSGA &lt;= 1)'
- title 3: 'Safety Population'

=========================================================================
Clean Up
=========================================================================

=========================================================================
Log End Time: 2021-11-21 15:30:39
Log Elapsed Time: 0 00:00:02
=========================================================================</code></pre>
<p>Next: <a href="sassy-profile.html">Example 8: Patient Profile</a></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by David Bosak.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
